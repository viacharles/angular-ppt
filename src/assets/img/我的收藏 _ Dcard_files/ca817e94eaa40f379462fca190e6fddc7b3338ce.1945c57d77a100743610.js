(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[34],{"05Ul":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("DRLc"),r=Object(a.a)({selectId:function(e){return e.id}})},"3ciz":function(e,t,n){"use strict";var a=n("pcOi"),r=n("1Au3");t.a=function(e,t){var n=Object(a.a)();Object(r.a)((function(){return n.events.on(e,t),function(){n.events.off(e,t)}}),[n,e,t])}},CCn4:function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e.BANNER="banner",e.ITEMS="items",e.ON_SALE="onSale",e.CATEGORIES="categories",e.PERSONALIZED="personalized",e.EDITORS_CHOICE="editorsChoice"}(a||(a={}))},OZ1t:function(e,t,n){"use strict";n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return k})),n.d(t,"a",(function(){return I}));var a=n("Czhu"),r=n("nnm9"),c=n.n(r),i=n("ERkP"),o=n.n(i),u=n("1Au3"),s=n("pcOi"),d=n("3ciz"),l=n("GRbO"),f=n("fAjh"),g=n("9e7o"),p=n("0qS3"),b=n("4w0+"),y=n("cHbO"),m=n("RpaF"),O=o.a.createElement,j=/\/f\/[^/]+\/p\/\d+(?:-[^?\s]+)?(?:.*)/,v={key:"",detail:""},h=o.a.createContext({source:{currentSource:v,previousSource:v,customizedSource:v},sourceProvider:c.a});function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=o.a.useContext(h),a=n.sourceProvider,r=Object(i.useCallback)(e,t);return Object(i.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a((function(e){r.apply(void 0,[e].concat(t))}))}),[r,a])}function k(){return o.a.useContext(h).source}function C(e,t,n){var r;return{currentSource:n,previousSource:t,customizedSource:(r=e.query,Object(a.a)(Object(a.a)(Object(a.a)(Object(a.a)(Object(a.a)(Object(a.a)({},r.utm_source&&{key:f.a.utm,detail:r.utm_source}),r.sourceKey&&{key:r.sourceKey}),r.sourceDetail&&{detail:r.sourceDetail}),r.sourceCellNo&&{cellNo:+r.sourceCellNo||0}),r.sourceItemPosition&&{itemPosition:+r.sourceItemPosition||0}),r.sourceFrom&&{from:r.sourceFrom}))}}function I(e){var t=e.children,n=Object(s.a)(),a=Object(i.useRef)([]),r=Object(i.useRef)(!1),c=function(e){var t=e.pathname,n=e.query,a=e.asPath,r=Object(g.a)((function(e){return Object(b.e)(e,n)})).listKey,c=Object(g.a)((function(e){return Object(p.f)(e,n.forumAlias||n.forum)})),o=c&&c.id||"all",u=Object(l.a)(n.latest),s=Object(g.a)(m.q);return Object(i.useMemo)((function(){if(Object(l.a)(n.pessoal))return{key:f.a.following,detail:o};if(Object(l.a)(n.topic))return{key:u?f.a.topicLatest:f.a.topicHot,detail:"".concat(n.topic)};if("/forum"===t&&!n.postId)return r===y.a.athenaHK?{key:f.a.athenaHK,detail:"all"}:{key:u?f.a.latest:f.a.hot,detail:o};if("/forum/all"===t)return{key:f.a.allForumList,detail:"all"};if("/forum/subscribed"===t)return{key:f.a.subscribedForumList,detail:"all"};if("/forum/popular"===t)return{key:f.a.realtimeHotForumList,detail:"all"};if("/forum/campaign"===t)return{key:f.a.specialEventForumList,detail:"all"};if(t.startsWith("/gamezone"))return{key:f.a.gamezoneList,detail:"gamezone"};if(t.startsWith("/persona")&&!n.postId){var e=s&&s.uid===n.uid;return{key:e?f.a.myPersonaPost:f.a.personaPost,detail:e?"all":n.uid}}return t.startsWith("/topic")?{key:n.latest?"topic_latest":"topic_hot",detail:"".concat(n.topic)}:t.startsWith("/search/forums")?{key:f.a.searchForums,detail:o,payload:{searchQuery:"".concat(n.query)}}:t.startsWith("/search/personas")?{key:f.a.searchPersona,detail:o,payload:{searchQuery:"".concat(n.query)}}:t.startsWith("/search/posts")?{key:f.a.searchPosts,detail:o,payload:{searchQuery:"".concat(n.query)}}:t.startsWith("/search/topics")?{key:f.a.searchTopics,detail:o,payload:{searchQuery:"".concat(n.query)}}:t.startsWith("/search")?{key:f.a.searchAll,detail:o,payload:{searchQuery:"".concat(n.query)}}:t.startsWith("/my/collection")?{key:f.a.collection,detail:"all"}:t.startsWith("/my/following")?{key:f.a.myFollowingPersona,detail:"all"}:t.startsWith("/my/posts")?{key:f.a.myPost,detail:"all"}:t.startsWith("/my/topics")?{key:f.a.myFollowingTopics,detail:"all"}:t.startsWith("/my/profile")?{key:f.a.myProfile,detail:"all"}:"/good"===t?{key:f.a.ecHome,detail:"all"}:j.test(a)?{key:f.a.post,detail:"".concat(n.postId)}:v}),[a,o,u,r,s,t,n])}(n),o=Object(i.useRef)(c),w=Object(i.useRef)(),k=Object(i.useCallback)((function(e){w.current&&(r.current?a.current.push(e):e(w.current.source))}),[]),I=Object(i.useState)((function(){return{sourceProvider:k,source:C(n,v,c)}})),S=I[0],P=I[1];Object(u.a)((function(){o.current=c,w.current=S}),[c,S]);var E=Object(i.useCallback)((function(e){r.current=!0}),[]),R=Object(i.useCallback)((function(e,t){r.current=!1}),[]),x=Object(i.useCallback)((function(e){if(r.current=!1,w.current){var t=C(n,w.current.source.currentSource,o.current);P({sourceProvider:k,source:t});for(var c=a.current;c.length;){var i=c.shift();i&&i(t)}}}),[n,k]);return Object(d.a)("routeChangeStart",E),Object(d.a)("routeChangeError",R),Object(d.a)("routeChangeComplete",x),O(h.Provider,{value:S},t)}},TZSo:function(e,t,n){"use strict";n.d(t,"c",(function(){return g})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return b})),n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return m}));var a=n("fGyu"),r=n("Czhu"),c=n("//nZ"),i=n.n(c),o=n("kdn0"),u=n("rjFl"),s=n("CCn4"),d=n("05Ul"),l=n("pQ7i"),f=n("h1LJ");var g=Object(o.d)({name:"catalog",initialState:{loading:!1,fetched:!1,error:null,personalizedFetched:!1,personalizedLoading:!1,data:{widgets:[]}},reducers:{},extraReducers:function(e){e.addCase(u.c.pending,(function(e){e.loading=!0})),e.addCase(u.c.rejected,(function(e,t){e.loading=!1,e.fetched=!0,e.error=t.error})),e.addCase(u.c.fulfilled,(function(e,t){var n=t.payload.widgets;e.data.widgets=function(e){var t;return(null!==(t=null===e||void 0===e?void 0:e.filter((function(e){return e.type!==s.a.BANNER})))&&void 0!==t?t:[]).map((function(e){var t,n;return e.type===s.a.CATEGORIES?Object(r.a)(Object(r.a)({},e),{},{categories:null!==(t=null===(n=e.categories)||void 0===n?void 0:n.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{imageUrl:Object(f.a)(e.imageUrl,{size:"h"})})})))&&void 0!==t?t:[]}):e.type===s.a.EDITORS_CHOICE?Object(r.a)(Object(r.a)({},e),{},{imageUrl:Object(f.a)(e.imageUrl,{size:"h"})}):e}))}(n),e.data.banner=function(e){var t=null===e||void 0===e?void 0:e.find((function(e){return e.type===s.a.BANNER}));if(t)return Object(r.a)(Object(r.a)({},t),{},{banners:t.banners.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{imageUrl:Object(f.a)(e.imageUrl,{size:"h"})})}))})}(n),e.loading=!1,e.fetched=!0})),e.addCase(u.a.pending,(function(e){e.personalizedLoading=!0})),e.addCase(u.a.rejected,(function(e,t){e.error=t.error,e.personalizedLoading=!1,e.personalizedFetched=!0})),e.addCase(u.a.fulfilled,(function(e,t){e.data=function(e,t){var n=Object(r.a)(Object(r.a)({},e.data),{},{widgets:Object(a.a)(e.data.widgets)});return t.forEach((function(e){if(e.type!==s.a.BANNER){var t=n.widgets.findIndex((function(t){return t.widgetKey===e.widgetKey}));t>=0&&(n.widgets[t]=e)}else n.banner=e})),n}(e,t.payload),e.personalizedLoading=!1,e.personalizedFetched=!0})),e.addCase(u.d.pending,(function(e,t){var n=e.data.widgets.findIndex((function(e){return e.widgetKey===t.meta.arg.widgetKey})),c=e.data.widgets[n];c&&(e.data.widgets[n]=Object(r.a)(Object(r.a)({},c),{},{items:Object(a.a)((c.items||[]).filter((function(e){return e.id!==t.meta.arg.exclude})))}))}))}}),p=Object(o.d)({name:"catalogWidgets",initialState:Object(r.a)(Object(r.a)({},d.a.getInitialState()),{},{widgetInfo:{}}),reducers:{},extraReducers:function(e){e.addCase(u.b.pending,(function(e,t){d.a.setPending(e,t.meta.arg.widgetKey)})),e.addCase(u.b.rejected,(function(e,t){d.a.setRejected(e,t.meta.arg.widgetKey,t.error)})),e.addCase(u.b.fulfilled,(function(e,t){d.a.setFulfilled(e,t.meta.arg.widgetKey),d.a.appendPagination(e,t.meta.arg.widgetKey,t.payload.items),d.a.setPagingNextKey(e,t.meta.arg.widgetKey,t.payload.next),e.widgetInfo[t.meta.arg.widgetKey]=i()(t.payload,["widgetId","widgetKey","bilanxKey","type","personalized","title","contentTitle","content"])})),e.addCase(u.d.pending,(function(e,t){var n=e.paginations[t.meta.arg.widgetKey];(null===n||void 0===n?void 0:n.index)&&(n.index=Object(a.a)(n.index.filter((function(e){return e!==t.meta.arg.exclude}))))}))}});function b(e){return"".concat(e.list,"-").concat(e.widget||e.listDetail,"-").concat(e.cellNo,"-").concat(e.itemPosition,"-").concat(e.itemId||e.itemText)}function y(e){return"banner-".concat(e)}var m=Object(o.d)({name:"catalogImpression",initialState:{sent:{}},reducers:{sendImpressions:function(e,t){for(var n=t.payload.map(b),a=0;a<n.length;a+=1){var r=n[a];e.sent[r]||(e.sent[r]=!0,l.b.bilanx.enqueue({event:"widgetItemViewed",payload:t.payload[a]}))}},sendBannerImpressions:function(e,t){var n=t.payload.bannerId;e.sent[y(n)]=!0,l.b.bilanx.enqueue({event:"carouselBannerClicked",payload:{list:"ec_home",listDetail:"all",bannerId:n||"",action:"view"}})},resetImpression:function(e){e.sent={}}}})},Ubr6:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return d})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return y})),n.d(t,"f",(function(){return m})),n.d(t,"g",(function(){return O})),n.d(t,"b",(function(){return j}));var a=n("+l7i"),r=n("CCn4"),c=n("05Ul"),i=function(e){return e.catalog},o=function(e){return e.catalog.data.widgets},u=function(e){return e.catalog.data.banner},s=Object(a.createSelector)(o,(function(e){return e.filter((function(e){var t;return!(e.type===r.a.ITEMS&&!(null===(t=e.items)||void 0===t?void 0:t.length))}))})),d=Object(a.createSelector)(o,u,(function(e,t){var n=e.filter((function(e){return e.personalized})).map((function(e){return e.widgetKey}));return(null===t||void 0===t?void 0:t.personalized)&&n.push(t.widgetKey),n})),l=c.a.getSelectors((function(e){return e.catalogWidgets})),f=l.selectPagingNextKey,g=l.selectPagination,p=l.selectByPagination;function b(e,t){return f(e,t)}function y(e,t){return g(e,t)}function m(e,t){return e.catalogWidgets.widgetInfo[t]}function O(e,t){return p(e,t)}function j(e){return e.catalogImpression.sent}},VkfP:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return O}));var a,r,c=n("RNvQ"),i=n.n(c),o=n("ERkP"),u=n("OZ1t"),s=n("uDfI"),d=n("syhI"),l=n("hcB2"),f=n("1PvQ"),g=Object(l.a)(f.d.SET_CURRENT_IMPRESSION_LIST),p=Object(l.a)(f.d.SEND_IMPRESSIONS),b=n("+2Gz");!function(e){e.EcBannerPost="ec_banner_post",e.EcDarsysPost="ec_darsys_post",e.EcPost="ec_post",e.EcCoupon="ec_coupon",e.EcSeries="ec_series",e.EcCategories="ec_categories",e.Forum="forum",e.Giftbox="giftbox",e.Post="post",e.Topic="topic"}(a||(a={})),function(e){e.FeaturedPost="featured_post",e.ForumCarousel="forum_carousel",e.Gamezone="gamezone",e.Giftbox="giftbox",e.OperationHawkeyeWidget="operation_hawkeye_widget",e.RelatedForums="related_forums",e.RelatedTopics="related_topics"}(r||(r={}));var y=[],m=i()((function(e){return e()}),200);function O(e){var t=e.cellNo,n=e.itemId,a=e.itemPosition,r=e.itemTag,c=e.itemText,i=e.itemType,l=e.widget,f=Object(o.useRef)(null),O=Object(d.a)(f,{threshold:.5}),j=Object(u.b)().currentSource,v=Object(o.useRef)(j),h=Object(o.useRef)("".concat(j.key,"-").concat(j.detail)),w=function(){var e=Object(s.d)();return Object(o.useRef)((function(t,n){y.push(t),m((function(){e(g(n)),e(p(y)),y.splice(0,y.length)}))})).current}();return Object(o.useEffect)((function(){v.current=j}),[j]),Object(o.useEffect)((function(){O&&Object(b.a)((function(){w({list:v.current.key,listDetail:v.current.detail,itemType:i,itemId:n,itemText:c,itemTag:r,cellNo:t||0,itemPosition:a||0,widget:l},h.current)}))}),[t,n,a,c,r,i,O,w,l]),f}},rjFl:function(e,t,n){"use strict";n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return f})),n.d(t,"d",(function(){return g}));var a=n("VtSi"),r=n.n(a),c=n("QsI/"),i=n("hcB2"),o=n("Nf2R"),u=n("Ubr6"),s=n("uDCT"),d=Object(i.c)("catalog/listCatalogWidgets",function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.default.get(t,"/api/v2/catalog"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{modifiers:[Object(s.a)((function(e){var t=Object(u.c)(e.getState());return!t.fetched&&!t.loading}))]}),l=Object(i.c)("catalog/getPersonalizedDetail",function(){var e=Object(c.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(u.e)(t.getState()),e.abrupt("return",o.default.get(t,"/api/v2/catalog/widgets",{widgetKeys:n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f=Object(i.c)("catalog/getWidget",function(){var e=Object(c.a)(r.a.mark((function e(t,n){var a,c,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.widgetKey,c=t.getState(),i=Object(u.h)(c,a),e.abrupt("return",o.default.get(t,"/api/v2/catalog/widgets/".concat(a),{pageKey:i}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),{modifiers:[Object(s.a)((function(e,t){var n=t.widgetKey,a=Object(u.i)(e.getState(),n);return!a||!a.loading}))]}),g=Object(i.c)("catalog/removeWidgetGoodItem",function(){var e=Object(c.a)(r.a.mark((function e(t,n){var a,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.widgetKey,c=n.exclude,e.abrupt("return",o.default.post(t,"/api/v2/catalog/feedbacks",{widgetKey:a,exclude:[c]}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}]);
